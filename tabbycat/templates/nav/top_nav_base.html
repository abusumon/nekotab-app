{% load debate_tags static i18n %}

<nav class="navbar navbar-expand-lg navbar-light">
  <div class="container">

  {# Decisions about whether to show items in the menu are based on the role of the user (not the view). #}
  {% blocktrans trimmed asvar logo_alt %}
    NekoTab Logo
  {% endblocktrans %}
  {% if all_tournaments.count > 1 or user.is_authenticated %}
    <div class="nav-item dropdown">

      <button class="btn btn-link mr-2 p-0 navbar-brand dropdown-toggle" id="tournamentdrop"
              data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        {% if on_local %}
          {% include "nav/logo_local.html" with width=33 height=33 alt=logo_alt %}
        {% else %}
          {% include "nav/logo.html" with width=33 height=33 alt=logo_alt %}
        {% endif %}
        {% if tournament %}{{ tournament }}{% else %}NekoTab{% endif %}
      </button>

      <div class="dropdown-menu" aria-labelledby="tournamentdrop">

        {% for tournament in all_tournaments %}

          {% if user.is_superuser %}
            <a class="dropdown-item px-2" href="{% url 'tournament-admin-home' tournament_slug=tournament.slug %}">
              <i data-feather="settings"></i>
              {% blocktrans trimmed %}
                Administrator area for <strong>{{ tournament }}</strong>
              {% endblocktrans %}
            </a>
          {% endif %}

          {% if user.is_authenticated %}
            <a class="dropdown-item px-2" href="{% url 'tournament-assistant-home' tournament_slug=tournament.slug %}">
              <i data-feather="pocket"></i>
              {% blocktrans trimmed %}
                Assistant area for <strong>{{ tournament }}</strong>
              {% endblocktrans %}
            </a>
          {% endif %}

          <a class="dropdown-item px-2" href="{% url 'tournament-public-index' tournament_slug=tournament.slug %}">
            {% if user.is_authenticated %}
              <i data-feather="globe"></i>
              {% blocktrans trimmed %}
                Public area for <strong>{{ tournament }}</strong>
              {% endblocktrans %}
            {% else %}
              <i data-feather="award"></i>
              {{ tournament }}
            {% endif %}
          </a>

          <div class="dropdown-divider"></div>
        {% endfor %}

        {% if user.is_staff %}
          <a href="{% url 'admin:index' %}" target="_blank" class="dropdown-item px-2">
            <i data-feather="database"></i>{% translate "Edit Database" %}
          </a>
          <div class="dropdown-divider"></div>
        {% endif %}

        <a class="dropdown-item px-2" href="/"><i data-feather="home"></i>{% trans "Site Home" %}</a>
      </div>

    </div>
  {% else %}
    <div class="nav-item">

      {% if tournament %}
        <a class="navbar-brand d-flex align-items-center" href="{{ tournament.get_public_url  }}" style="font-weight: 700; letter-spacing: -0.02em;">
          {% include "nav/logo.html" with width=40 height=40  alt=logo_alt %}
          <span class="ml-2" style="font-size: 1.15rem;">{{ tournament }}</span>
        </a>
      {% else %}
        <a class="navbar-brand d-flex align-items-center" href="/" style="font-weight: 700; letter-spacing: -0.02em;">
          {% include "nav/logo.html" with width=40 height=40 alt=logo_alt %}
          <span class="ml-2" style="font-size: 1.15rem;">NekoTab</span>
        </a>
      {% endif %}

    </div>
  {% endif %}

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#collapsed-main-nav" aria-controls="collapsed-main-nav" aria-expanded="false" aria-label="Toggle navigation" style="border: none;">
    <span class="navbar-toggler-icon" style="background-size: 100% 100%;"></span>
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" style="vertical-align: middle;">
      <path d="M3 6h18M3 12h18M3 18h18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
    </svg>
    <span class="sr-only">Toggle navigation</span>
  </button>

  <div class="collapse navbar-collapse pt-3 pt-md-0 pb-2 pb-md-0" id="collapsed-main-nav">

    <ul class="navbar-nav mr-auto">

      {% if user_role == "assistant" %}
        {% include "nav/assistant_nav.html" %}
      {% else %}
        {% include "nav/public_nav.html" %}
      {% endif %}

    </ul>

    <ul class="navbar-nav navbar-my-lg-0">
      {% if user.is_authenticated %}
        <li class="nav-item">
          <form id="logout-form" action="{% url 'logout' %}" method="post">
            {% csrf_token %}
            <button type="submit" class="btn btn-link nav-link">
              {% trans "Log Out" %} ({{ user }})
            </button>
          </form>
        </li>
      {% else %}
        <li class="nav-item mr-2">
          <a class="btn btn-outline-primary" href="{% url 'login' %}" style="border-radius: 999px; padding: 0.5rem 1.3rem; font-weight: 600; border-width: 2px;">
            {% trans "Log In" %}
          </a>
        </li>
        <li class="nav-item">
          <a class="btn btn-primary" href="{% url 'signup' %}" style="border-radius: 999px; padding: 0.5rem 1.3rem; font-weight: 600; box-shadow: 0 4px 14px rgba(102, 126, 234, 0.3);">
            {% trans "Sign Up" %}
          </a>
        </li>
      {% endif %}
    </ul>

  </div>

  </div>
</nav>
