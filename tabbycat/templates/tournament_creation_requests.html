{% load static i18n %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Tournament Creation Requests</title>
  <link rel="stylesheet" href="{% static 'css/landing.css' %}">
  <style>
    table { width:100%; border-collapse:collapse; margin-top:32px; }
    th, td { padding:12px 10px; text-align:left; border-bottom:1px solid #e5e7eb; font-size:14px; }
    th { background:#f9fafb; font-weight:600; }
    tbody tr:hover { background:#f3f4f6; }
    .otp { font-family:monospace; letter-spacing:1px; }
    .status { font-weight:600; }
    .badge { display:inline-block; padding:2px 8px; border-radius:12px; font-size:12px; background:#eef2ff; color:#4f46e5; }
    .expired { background:#fef2f2; color:#dc2626; }
    .completed { background:#ecfdf5; color:#059669; }
    .pending { background:#fff7ed; color:#d97706; }
    .actions { white-space:nowrap; }
    .copy-btn { background:#6366f1; color:#fff; border:none; padding:6px 12px; border-radius:6px; cursor:pointer; font-size:12px; }
    .copy-btn:hover { background:#4f46e5; }
  </style>
</head>
<body class="em-body">
  <div class="em-container">
    <h1 style="margin-top:40px;">Tournament Creation Requests (OTP Inbox)</h1>
    <p style="max-width:720px;">This page lists all pending or completed tournament creation requests. Share the OTP with the requester after payment. Expired requests will need to be resubmitted.</p>

    <table aria-label="Tournament creation requests">
      <thead>
        <tr>
          <th scope="col">Email</th>
          <th scope="col">User</th>
          <th scope="col">Tournament Name</th>
          <th scope="col">Slug</th>
          <th scope="col">OTP</th>
          <th scope="col">Status</th>
          <th scope="col">Created</th>
          <th scope="col">Expires</th>
          <th scope="col" class="actions">Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for r in requests %}
          <tr>
            <td><a href="mailto:{{ r.user.email }}">{{ r.user.email }}</a></td>
            <td>{{ r.user.username }}</td>
            <td>{{ r.requested_name|default:'(missing)' }}</td>
            <td>{{ r.requested_slug|default:'(missing)' }}</td>
            <td class="otp">{{ r.otp_code }}</td>
            <td><span class="badge {% if r.status == 'expired' %}expired{% elif r.status == 'completed' %}completed{% elif r.status == 'pending' %}pending{% endif %}">{{ r.get_status_display }}</span></td>
            <td>{{ r.created_at|date:'Y-m-d H:i' }}</td>
            <td>{{ r.expires_at|date:'Y-m-d H:i' }}</td>
            <td class="actions">
              <button class="copy-btn" data-otp="{{ r.otp_code }}">Copy OTP</button>
              <button class="copy-btn" style="background:#10b981; margin-left:8px;" data-email="{{ r.user.email }}">Copy Email</button>
            </td>
          </tr>
        {% empty %}
          <tr><td colspan="8">No creation requests yet.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  <script>
    document.querySelectorAll('.copy-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const otp = btn.getAttribute('data-otp');
        const email = btn.getAttribute('data-email');
        const value = otp || email || '';
        navigator.clipboard.writeText(value).then(() => {
          const original = btn.textContent;
          btn.textContent = 'Copied!';
          setTimeout(() => btn.textContent = original, 1500);
        });
      });
    });
  </script>
</body>
</html>
