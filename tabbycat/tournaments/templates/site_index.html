{% extends "base.html" %}
{% load i18n static %}

{% block head-title %}<span class="emoji">üëã</span> {% trans "Welcome!" %}{% endblock %}
{% block page-title %}Home{% endblock %}

{% block page-alerts %}
  {% include 'errors/database_limit_warning.html' %}
  {% include 'errors/legacy_sendgrid_warning.html' %}
{% endblock %}

{% block content %}

{% if not user.is_authenticated %}
  <!-- Immersive Public Hero -->
  <section id="hero" class="d-flex align-items-center" style="min-height: 90vh; position: relative; overflow: hidden; background: linear-gradient(135deg,#0f172a 0,#1a1f35 50%, #2d3548 100%); color: #fff;">
    <div class="container px-3 px-md-4">
      <div class="row align-items-center">
        <div class="col-lg-6 col-md-12 mb-4 mb-lg-0 text-center text-lg-left">
          <h1 class="font-weight-bold mb-3" style="font-size: clamp(1.75rem, 5vw, 3rem); line-height: 1.2;">
            {% trans "Run Your Debate Tournaments Effortlessly." %}
          </h1>
          <p class="lead mb-4" style="font-size: clamp(1rem, 2.5vw, 1.3rem); line-height: 1.6; opacity: 0.9; max-width: 600px; margin-left: auto; margin-right: auto;">
            {% trans "Beautiful, reliable, and local ‚Äî host tournaments for just ‡ß≥2500, paid easily with bKash." %}
          </p>

          <div class="d-flex flex-column flex-sm-row justify-content-center justify-content-lg-start align-items-center" style="gap: 1rem;">
            <a href="{% url 'login' %}?next={% url 'tournament-create' %}" class="btn btn-primary btn-lg shadow-lg" style="border-radius: 12px; padding: 0.85rem 2rem; font-weight: 600; transition: all 0.3s ease;">
              {% trans "Host Your Tournament" %}
            </a>

            <button class="btn btn-outline-light btn-lg" data-toggle="modal" data-target="#demoModal" style="border-radius: 12px; padding: 0.85rem 2rem; font-weight: 600; transition: all 0.3s ease; border-width: 2px;">
              {% trans "View Demo" %}
            </button>
          </div>

          <!-- Stat counters -->
          <div class="d-flex flex-wrap justify-content-center justify-content-lg-start mt-4 mt-md-5" style="gap: 2rem;">
            <div class="text-center text-lg-left">
              <div class="h2 mb-1 font-weight-bold" data-target="120" style="color: #667eea;">0</div>
              <div style="font-size: 0.9rem; opacity: 0.8;">{% trans "Debaters" %}</div>
            </div>
            <div class="text-center text-lg-left">
              <div class="h2 mb-1 font-weight-bold" data-target="10" style="color: #667eea;">0</div>
              <div style="font-size: 0.9rem; opacity: 0.8;">{% trans "Tournaments Hosted" %}</div>
            </div>
            <div class="text-center text-lg-left">
              <div class="h2 mb-1 font-weight-bold" data-target="99.9" style="color: #667eea;">0</div>
              <div style="font-size: 0.9rem; opacity: 0.8;">{% trans "Uptime (%)" %}</div>
            </div>
          </div>
        </div>

        <div class="col-lg-6 col-md-12 d-flex justify-content-center align-items-center" style="position: relative;">
          <!-- Floating dashboard mockup -->
          <div class="dashboard-mockup" style="width: 100%; max-width: 480px; transform: translateY(0); animation: float 6s ease-in-out infinite;">
            <div class="card shadow-lg" style="border-radius: 20px; overflow: hidden; border: none;">
              <div style="background: linear-gradient(135deg, #f8fafc 0%, #eef2ff 100%); padding: 1.5rem;">
                <div style="height: 280px; background: linear-gradient(135deg, #e0e7ff 0%, #f8fafc 100%); border-radius: 16px; display: flex; align-items: center; justify-content: center; color: #475569; font-weight: 600; font-size: 1.1rem; box-shadow: 0 4px 20px rgba(0,0,0,0.08);">
                  {% trans "Tournament Dashboard Preview" %}
                </div>
                <div style="display:flex; gap:0.75rem; margin-top:1.2rem;">
                  <div style="flex:1; height:12px; background:#c7d2fe; border-radius:8px;"></div>
                  <div style="flex:1.5; height:12px; background:#818cf8; border-radius:8px;"></div>
                  <div style="flex:0.8; height:12px; background:#a5b4fc; border-radius:8px;"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Demo Modal with Image -->
    <div class="modal fade" id="demoModal" tabindex="-1" role="dialog" aria-labelledby="demoModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
        <div class="modal-content" style="border-radius: 16px; border: none; overflow: hidden;">
          <div class="modal-header border-0" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
            <h5 class="modal-title font-weight-bold" id="demoModalLabel">{% trans "NekoTab Platform Demo" %}</h5>
            <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close" style="opacity: 1;">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body p-0">
            <!-- Demo screenshot/image - replace with your actual demo image -->
            <img src="{% static 'branding/logo.png' %}" alt="{% trans 'NekoTab Demo Screenshot' %}" class="img-fluid w-100" style="display: block; max-height: 70vh; object-fit: contain; background: #f8fafc;">
            <div class="p-4 text-center" style="background: #f8fafc;">
              <p class="mb-3 text-muted">{% trans "See how NekoTab simplifies tournament management with an intuitive interface" %}</p>
              <a href="{% url 'login' %}?next={% url 'tournament-create' %}" class="btn btn-primary" style="border-radius: 8px; padding: 0.6rem 1.5rem;">
                {% trans "Get Started" %}
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <style>
      @keyframes float { 
        0%, 100% { transform: translateY(0) rotate(0deg); } 
        50% { transform: translateY(-15px) rotate(1deg); } 
      }
      
      #hero { padding: 2rem 0; }
      
      @media (max-width: 991.98px) {
        .dashboard-mockup { 
          margin-top: 2rem; 
          animation: none !important; 
          max-width: 100% !important;
        }
      }
      
      .btn-primary:hover { 
        transform: translateY(-2px); 
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4) !important; 
      }
      
      .btn-outline-light:hover { 
        background: rgba(255,255,255,0.1); 
        transform: translateY(-2px); 
      }
    </style>

    <script>
      // small counter animation
      (function(){
        function animateCounters(){
          document.querySelectorAll('#hero [data-target]').forEach(function(el){
            var target = parseFloat(el.getAttribute('data-target')) || 0;
            var isFloat = (el.getAttribute('data-target').indexOf('.') !== -1);
            var duration = 1400; var start = 0; var startTime = null;
            function step(timestamp){
              if(!startTime) startTime = timestamp;
              var progress = Math.min((timestamp - startTime) / duration, 1);
              var value = start + (target - start) * progress;
              el.textContent = isFloat ? value.toFixed(1) : Math.floor(value);
              if(progress < 1) window.requestAnimationFrame(step);
            }
            window.requestAnimationFrame(step);
          });
        }
        if(document.readyState === 'complete') animateCounters(); else window.addEventListener('load', animateCounters);
      })();
    </script>
  </section>

  <!-- USP Section -->
  <section class="py-5" style="background: linear-gradient(180deg, #f8fafc 0%, #ffffff 100%);">
    <div class="container px-3 px-md-4 py-4">
      <div class="text-center mb-5">
        <h2 class="font-weight-bold mb-2" style="font-size: clamp(1.5rem, 3.5vw, 2rem); color: #1e293b;">
          {% trans "What Makes NekoTab Different" %}
        </h2>
        <p class="text-muted" style="font-size: clamp(0.95rem, 2vw, 1.1rem);">
          {% trans "Built for speed, fairness and simplicity." %}
        </p>
      </div>

      <div class="row">
        <div class="col-lg-4 col-md-6 mb-4">
          <div class="h-100 p-4 rounded-lg shadow-sm" style="background: white; border-radius: 16px; transition: all 0.3s ease; border: 1px solid #e2e8f0;">
            <div class="mb-3" style="font-size: 42px;">‚öôÔ∏è</div>
            <h5 class="font-weight-bold mb-3" style="color: #1e293b;">{% trans "Smart Tab Engine" %}</h5>
            <p class="text-muted mb-0" style="line-height: 1.7;">
              {% trans "Built on the trusted Tabbycat core, with custom automation for faster pairing and tab releases." %}
            </p>
          </div>
        </div>
        <div class="col-lg-4 col-md-6 mb-4">
          <div class="h-100 p-4 rounded-lg shadow-sm" style="background: white; border-radius: 16px; transition: all 0.3s ease; border: 1px solid #e2e8f0;">
            <div class="mb-3" style="font-size: 42px;">üí≥</div>
            <h5 class="font-weight-bold mb-3" style="color: #1e293b;">{% trans "Transparent Pricing" %}</h5>
            <p class="text-muted mb-0" style="line-height: 1.7;">
              {% trans "Flat ‡ß≥2500 per tournament, no hidden cost. Pay securely through bKash." %}
            </p>
          </div>
        </div>
        <div class="col-lg-4 col-md-6 mb-4">
          <div class="h-100 p-4 rounded-lg shadow-sm" style="background: white; border-radius: 16px; transition: all 0.3s ease; border: 1px solid #e2e8f0;">
            <div class="mb-3" style="font-size: 42px;">üì±</div>
            <h5 class="font-weight-bold mb-3" style="color: #1e293b;">{% trans "Works on Any Device" %}</h5>
            <p class="text-muted mb-0" style="line-height: 1.7;">
              {% trans "Optimized for desktop, tablet, and mobile ‚Äî perfect for tab rooms and on-the-go judges." %}
            </p>
          </div>
        </div>
      </div>
    </div>
  </section>
  
  <style>
    .rounded-lg:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 40px rgba(0,0,0,0.12) !important;
      border-color: #c7d2fe !important;
    }
  </style>

{% else %}
  <!-- Authenticated User Dashboard: only show tournaments the user arranged -->
  {% if tournaments %}
    <div class="mb-4">
      <h2 class="mb-3">{% trans "Your Tournaments" %}</h2>
      {% for tournament in tournaments %}
        {% include "tournament_index_links.html" %}
      {% endfor %}
    </div>
  {% else %}
    <div class="card border-0 shadow-sm mb-4">
      <div class="card-body text-center py-5">
        <div class="mb-3" style="color: #667eea;">
          <i data-feather="calendar" style="width: 64px; height: 64px;"></i>
        </div>
        <h3 class="mb-3">{% trans "No Tournaments Yet" %}</h3>
        <p class="text-muted mb-4">{% trans "Get started by creating your first tournament." %}</p>
        <a href="{% url 'tournament-create' %}" class="btn btn-primary btn-lg">
          <i data-feather="plus-circle" style="width: 18px; height: 18px;"></i>
          {% trans "Create Tournament" %}
        </a>
      </div>
    </div>
  {% endif %}

  {% if inactive %}
    <div class="mb-4">
      <h3 class="mb-3 text-muted">{% trans "Inactive Tournaments" %}</h3>
      <div class="list-group">
        {% trans '(inactive)' as inactive_subtext %}
        {% for tournament in inactive %}
          {% include "tournament_index_links.html" with type="dark" subtext=inactive_subtext %}
        {% endfor %}
      </div>
    </div>
  {% endif %}
{% endif %}

<div class="list-group mt-2">
  {% if user.is_superuser %}

    {% trans "New Tournament" as text %}{% url 'tournament-create' as url %}
    {% include "components/item-action.html" with icon="plus-circle" %}

    {% trans "Edit Database Area" as text %}{% url 'admin:index' as url %}
    {% include "components/item-action.html" with icon="edit" %}

    {% trans "Send a Test Email" as text %}{% url 'notifications-test-email' as url %}
    {% include "components/item-action.html" with icon="send" %}

    {% trans "Import DebateXML" as text %}{% url 'importer-archive' as url %}
    {% include "components/item-action.html" with icon="archive" %}

  {% endif %}
</div>

<div class="list-group mt-2">
  {% if user.is_authenticated %}

    {% blocktrans asvar text %}Get API Token / Change Password ({{ user }}){% endblocktrans %}
    {% url 'password_change' as url %}
    {% include "components/item-action.html" with icon="rotate-cw" %}

    <form id="logout-link-form" method="post" action="{% url 'logout' %}" class="list-group-item list-group-item-action text-primary">
      {% csrf_token %}
      <button type="submit" class="btn btn-link p-0 list-group-item-action text-primary">
        <div class="row align-items-center">
          <div class="col-auto pr-1">
            <i data-feather="log-out"></i>
          </div>

          <div class="col pl-0 pr-0">
            {% blocktrans %}Log Out ({{ user }}){% endblocktrans %}
          </div>

          <div class="col-auto pr-1">
            <i data-feather="chevron-right"></i>
          </div>
        </div>
      </button>
    </form>

  {% endif %}
</div>

{% endblock content %}
